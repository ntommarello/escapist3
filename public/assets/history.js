(function(x,w){var v=x.console||w,u=x.document,t=x.navigator,s=x.amplify||!1,r=x.setTimeout,q=x.clearTimeout,p=x.setInterval,o=x.JSON,n=x.History=x.History||{},m=x.history;o.stringify=o.stringify||o.encode,o.parse=o.parse||o.decode;if(typeof n.init!="undefined"){throw new Error("History.js Core has already been loaded...")}n.init=function(){if(typeof n.Adapter=="undefined"){return !1}typeof n.initCore!="undefined"&&n.initCore(),typeof n.initHtml4!="undefined"&&n.initHtml4();return !0},n.initCore=function(){if(typeof n.initCore.initialized!="undefined"){return !1}n.initCore.initialized=!0,n.options=n.options||{},n.options.hashChangeInterval=n.options.hashChangeInterval||100,n.options.safariPollInterval=n.options.safariPollInterval||500,n.options.doubleCheckInterval=n.options.doubleCheckInterval||500,n.options.storeInterval=n.options.storeInterval||1000,n.options.busyDelay=n.options.busyDelay||250,n.options.debug=n.options.debug||!1,n.options.initialTitle=n.options.initialTitle||u.title,n.debug=function(){(n.options.debug||!1)&&n.log.apply(n,arguments)},n.log=function(){var d=typeof v!="undefined"&&typeof v.log!="undefined"&&typeof v.log.apply!="undefined",c=u.getElementById("log"),B,A,z;if(d){var y=Array.prototype.slice.call(arguments);B=y.shift(),typeof v.debug!="undefined"?v.debug.apply(v,[B,y]):v.log.apply(v,[B,y])}else{B="\n"+arguments[0]+"\n"}for(A=1,z=arguments.length;A<z;++A){var l=arguments[A];if(typeof l=="object"&&typeof o!="undefined"){try{l=o.stringify(l)}catch(j){}}B+="\n"+l+"\n"}c?(c.value+=B+"\n-----\n",c.scrollTop=c.scrollHeight-c.clientHeight):d||alert(B);return !0},n.getInternetExplorerMajorVersion=function(){var b=n.getInternetExplorerMajorVersion.cached=typeof n.getInternetExplorerMajorVersion.cached!="undefined"?n.getInternetExplorerMajorVersion.cached:function(){var e=3,d=u.createElement("div"),f=d.getElementsByTagName("i");while((d.innerHTML="<!--[if gt IE "+ ++e+"]><i></i><![endif]-->")&&f[0]){}return e>4?e:!1}();return b},n.isInternetExplorer=function(){var b=n.isInternetExplorer.cached=typeof n.isInternetExplorer.cached!="undefined"?n.isInternetExplorer.cached:Boolean(n.getInternetExplorerMajorVersion());return b},n.emulated={pushState:!Boolean(x.history&&x.history.pushState&&x.history.replaceState&&!/ Mobile\/([1-7][a-z]|(8([abcde]|f(1[0-8]))))/i.test(t.userAgent)&&!/AppleWebKit\/5([0-2]|3[0-2])/i.test(t.userAgent)),hashChange:Boolean(!("onhashchange" in x||"onhashchange" in u)||n.isInternetExplorer()&&n.getInternetExplorerMajorVersion()<8)},n.enabled=!n.emulated.pushState,n.bugs={setHash:Boolean(!n.emulated.pushState&&t.vendor==="Apple Computer, Inc."&&/AppleWebKit\/5([0-2]|3[0-3])/.test(t.userAgent)),safariPoll:Boolean(!n.emulated.pushState&&t.vendor==="Apple Computer, Inc."&&/AppleWebKit\/5([0-2]|3[0-3])/.test(t.userAgent)),ieDoubleCheck:Boolean(n.isInternetExplorer()&&n.getInternetExplorerMajorVersion()<8),hashEscape:Boolean(n.isInternetExplorer()&&n.getInternetExplorerMajorVersion()<7)},n.isEmptyObject=function(d){for(var c in d){return !1}return !0},n.cloneObject=function(e){var d,f;e?(d=o.stringify(e),f=o.parse(d)):f={};return f},n.getRootUrl=function(){var b=u.location.protocol+"//"+(u.location.hostname||u.location.host);if(u.location.port||!1){b+=":"+u.location.port}b+="/";return b},n.getBaseHref=function(){var e=u.getElementsByTagName("base"),d=null,f="";e.length===1&&(d=e[0],f=d.href.replace(/[^\/]+$/,"")),f=f.replace(/\/+$/,""),f&&(f+="/");return f},n.getBaseUrl=function(){var b=n.getBaseHref()||n.getBasePageUrl()||n.getRootUrl();return b},n.getPageUrl=function(){var e=n.getState(!1,!1),d=(e||{}).url||u.location.href,f=d.replace(/\/+$/,"").replace(/[^\/]+$/,function(h,g,i){return/\./.test(h)?h:h+"/"});return f},n.getBasePageUrl=function(){var b=u.location.href.replace(/[#\?].*/,"").replace(/[^\/]+$/,function(e,d,f){return/[^\/]$/.test(e)?"":e}).replace(/\/+$/,"")+"/";return b},n.getFullUrl=function(f,e){var h=f,g=f.substring(0,1);e=typeof e=="undefined"?!0:e,/[a-z]+\:\/\//.test(f)||(g==="/"?h=n.getRootUrl()+f.replace(/^\/+/,""):g==="#"?h=n.getPageUrl().replace(/#.*/,"")+f:g==="?"?h=n.getPageUrl().replace(/[\?#].*/,"")+f:e?h=n.getBaseUrl()+f.replace(/^(\.\/)+/,""):h=n.getBasePageUrl()+f.replace(/^(\.\/)+/,""));return h.replace(/\#$/,"")},n.getShortUrl=function(f){var e=f,h=n.getBaseUrl(),g=n.getRootUrl();n.emulated.pushState&&(e=e.replace(h,"")),e=e.replace(g,"/"),n.isTraditionalAnchor(e)&&(e="./"+e),e=e.replace(/^(\.\/)+/g,"./").replace(/\#$/,"");return e},n.store=s?s.store("History.store")||{}:{},n.store.idToState=n.store.idToState||{},n.store.urlToId=n.store.urlToId||{},n.store.stateToId=n.store.stateToId||{},n.idToState=n.idToState||{},n.stateToId=n.stateToId||{},n.urlToId=n.urlToId||{},n.storedStates=n.storedStates||[],n.savedStates=n.savedStates||[],n.getState=function(e,d){typeof e=="undefined"&&(e=!0),typeof d=="undefined"&&(d=!0);var f=n.getLastSavedState();!f&&d&&(f=n.createStateObject()),e&&(f=n.cloneObject(f),f.url=f.cleanUrl||f.url);return f},n.getIdByState=function(e){var d=n.extractId(e.url);if(!d){var f=n.getStateString(e);if(typeof n.stateToId[f]!="undefined"){d=n.stateToId[f]}else{if(typeof n.store.stateToId[f]!="undefined"){d=n.store.stateToId[f]}else{for(;;){d=String(Math.floor(Math.random()*1000));if(typeof n.idToState[d]=="undefined"&&typeof n.store.idToState[d]=="undefined"){break}}n.stateToId[f]=d,n.idToState[d]=e}}}return d},n.normalizeState=function(e){if(!e||typeof e!="object"){e={}}if(typeof e.normalized!="undefined"){return e}if(!e.data||typeof e.data!="object"){e.data={}}var d={};d.normalized=!0,d.title=e.title||"",d.url=n.getFullUrl(n.unescapeString(e.url||u.location.href)),d.hash=n.getShortUrl(d.url),d.data=n.cloneObject(e.data),d.id=n.getIdByState(d),d.cleanUrl=d.url.replace(/\??\&_suid.*/,""),d.url=d.cleanUrl;var f=!n.isEmptyObject(d.data);if(d.title||f){d.hash=n.getShortUrl(d.url).replace(/\??\&_suid.*/,""),/\?/.test(d.hash)||(d.hash+="?"),d.hash+="&_suid="+d.id}d.hashedUrl=n.getFullUrl(d.hash),(n.emulated.pushState||n.bugs.safariPoll)&&n.hasUrlDuplicate(d)&&(d.url=d.hashedUrl);return d},n.createStateObject=function(f,e,h){var g={data:f,title:e,url:h};g=n.normalizeState(g);return g},n.getStateById=function(b){b=String(b);var d=n.idToState[b]||n.store.idToState[b]||w;return d},n.getStateString=function(f){var e=n.normalizeState(f),h={data:e.data,title:f.title,url:f.url},g=o.stringify(h);return g},n.getStateId=function(e){var d=n.normalizeState(e),f=d.id;return f},n.getHashByState=function(e){var d,f=n.normalizeState(e);d=f.hash;return d},n.extractId=function(f){var e,h,g;h=/(.*)\&_suid=([0-9]+)$/.exec(f),g=h?h[1]||f:f,e=h?String(h[2]||""):"";return e||!1},n.isTraditionalAnchor=function(d){var c=!/[\/\?\.]/.test(d);return c},n.extractState=function(g,f){var j=null;f=f||!1;var i=n.extractId(g);i&&(j=n.getStateById(i));if(!j){var h=n.getFullUrl(g);i=n.getIdByUrl(h)||!1,i&&(j=n.getStateById(i)),!j&&f&&!n.isTraditionalAnchor(g)&&(j=n.createStateObject(null,null,h))}return j},n.getIdByUrl=function(b){var d=n.urlToId[b]||n.store.urlToId[b]||w;return d},n.getLastSavedState=function(){return n.savedStates[n.savedStates.length-1]||w},n.getLastStoredState=function(){return n.storedStates[n.storedStates.length-1]||w},n.hasUrlDuplicate=function(e){var d=!1,f=n.extractState(e.url);d=f&&f.id!==e.id;return d},n.storeState=function(b){n.urlToId[b.url]=b.id,n.storedStates.push(n.cloneObject(b));return b},n.isLastSavedState=function(g){var f=!1;if(n.savedStates.length){var j=g.id,i=n.getLastSavedState(),h=i.id;f=j===h}return f},n.saveState=function(b){if(n.isLastSavedState(b)){return !1}n.savedStates.push(n.cloneObject(b));return !0},n.getStateByIndex=function(d){var c=null;typeof d=="undefined"?c=n.savedStates[n.savedStates.length-1]:d<0?c=n.savedStates[n.savedStates.length+d]:c=n.savedStates[d];return c},n.getHash=function(){var b=n.unescapeHash(u.location.hash);return b},n.unescapeString=function(e){var g=e,f;for(;;){f=x.unescape(g);if(f===g){break}g=f}return g},n.unescapeHash=function(d){var c=n.normalizeHash(d);c=n.unescapeString(c);return c},n.normalizeHash=function(d){var c=d.replace(/[^#]*#/,"").replace(/#.*/,"");return c},n.setHash=function(g,d){if(d!==!1&&n.busy()){n.pushQueue({scope:n,callback:n.setHash,args:arguments,queue:d});return !1}var j=n.escapeHash(g);n.busy(!0);var i=n.extractState(g,!0);if(i&&!n.emulated.pushState){n.pushState(i.data,i.title,i.url,!1)}else{if(u.location.hash!==j){if(n.bugs.setHash){var h=n.getPageUrl();n.pushState(null,null,h+"#"+j,!1)}else{u.location.hash=j}}}return n},n.escapeHash=function(d){var e=n.normalizeHash(d);e=x.escape(e),n.bugs.hashEscape||(e=e.replace(/\%21/g,"!").replace(/\%26/g,"&").replace(/\%3D/g,"=").replace(/\%3F/g,"?"));return e},n.getHashByUrl=function(d){var c=String(d).replace(/([^#]*)#?([^#]*)#?(.*)/,"$2");c=n.unescapeHash(c);return c},n.setTitle=function(f){var d=f.title;if(!d){var h=n.getStateByIndex(0);h&&h.url===f.url&&(d=h.title||n.options.initialTitle)}try{u.getElementsByTagName("title")[0].innerHTML=d.replace("<","&lt;").replace(">","&gt;").replace(" & "," &amp; ")}catch(g){}u.title=d;return n},n.queues=[],n.busy=function(d){typeof d!="undefined"?n.busy.flag=d:typeof n.busy.flag=="undefined"&&(n.busy.flag=!1);if(!n.busy.flag){q(n.busy.timeout);var c=function(){if(!n.busy.flag){for(var b=n.queues.length-1;b>=0;--b){var f=n.queues[b];if(f.length===0){continue}var e=f.shift();n.fireQueueItem(e),n.busy.timeout=r(c,n.options.busyDelay)}}};n.busy.timeout=r(c,n.options.busyDelay)}return n.busy.flag},n.fireQueueItem=function(b){return b.callback.apply(b.scope||n,b.args||[])},n.pushQueue=function(b){n.queues[b.queue||0]=n.queues[b.queue||0]||[],n.queues[b.queue||0].push(b);return n},n.queue=function(d,c){typeof d=="function"&&(d={callback:d}),typeof c!="undefined"&&(d.queue=c),n.busy()?n.pushQueue(d):n.fireQueueItem(d);return n},n.clearQueue=function(){n.busy.flag=!1,n.queues=[];return n},n.stateChanged=!1,n.doubleChecker=!1,n.doubleCheckComplete=function(){n.stateChanged=!0,n.doubleCheckClear();return n},n.doubleCheckClear=function(){n.doubleChecker&&(q(n.doubleChecker),n.doubleChecker=!1);return n},n.doubleCheck=function(b){n.stateChanged=!1,n.doubleCheckClear(),n.bugs.ieDoubleCheck&&(n.doubleChecker=r(function(){n.doubleCheckClear(),n.stateChanged||b();return !0},n.options.doubleCheckInterval));return n},n.safariStatePoll=function(){var d=n.extractState(u.location.href),e;if(!n.isLastSavedState(d)){e=d}else{return}e||(e=n.createStateObject()),n.Adapter.trigger(x,"popstate");return n},n.back=function(b){if(b!==!1&&n.busy()){n.pushQueue({scope:n,callback:n.back,args:arguments,queue:b});return !1}n.busy(!0),n.doubleCheck(function(){n.back(!1)}),m.go(-1);return !0},n.forward=function(b){if(b!==!1&&n.busy()){n.pushQueue({scope:n,callback:n.forward,args:arguments,queue:b});return !1}n.busy(!0),n.doubleCheck(function(){n.forward(!1)}),m.go(1);return !0},n.go=function(e,d){var f;if(e>0){for(f=1;f<=e;++f){n.forward(d)}}else{if(!(e<0)){throw new Error("History.go: History.go requires a positive or negative integer passed.")}for(f=-1;f>=e;--f){n.back(d)}}return n},n.saveState(n.storeState(n.extractState(u.location.href,!0))),s&&(n.onUnload=function(){var d=s.store("History.store")||{},c;d.idToState=d.idToState||{},d.urlToId=d.urlToId||{},d.stateToId=d.stateToId||{};for(c in n.idToState){if(!n.idToState.hasOwnProperty(c)){continue}d.idToState[c]=n.idToState[c]}for(c in n.urlToId){if(!n.urlToId.hasOwnProperty(c)){continue}d.urlToId[c]=n.urlToId[c]}for(c in n.stateToId){if(!n.stateToId.hasOwnProperty(c)){continue}d.stateToId[c]=n.stateToId[c]}n.store=d,s.store("History.store",d)},p(n.onUnload,n.options.storeInterval),n.Adapter.bind(x,"beforeunload",n.onUnload),n.Adapter.bind(x,"unload",n.onUnload));if(n.emulated.pushState){var a=function(){};n.pushState=n.pushState||a,n.replaceState=n.replaceState||a}else{n.onPopState=function(d){n.doubleCheckComplete();var i=n.getHash();if(i){var h=n.extractState(i||u.location.href,!0);h?n.replaceState(h.data,h.title,h.url,!1):(n.Adapter.trigger(x,"anchorchange"),n.busy(!1)),n.expectedStateId=!1;return !1}var g=!1;d=d||{},typeof d.state=="undefined"&&(typeof d.originalEvent!="undefined"&&typeof d.originalEvent.state!="undefined"?d.state=d.originalEvent.state||!1:typeof d.event!="undefined"&&typeof d.event.state!="undefined"&&(d.state=d.event.state||!1)),d.state=d.state||!1,d.state?g=n.getStateById(d.state):n.expectedStateId?g=n.getStateById(n.expectedStateId):g=n.extractState(u.location.href),g||(g=n.createStateObject(null,null,u.location.href)),n.expectedStateId=!1;if(n.isLastSavedState(g)){n.busy(!1);return !1}n.storeState(g),n.saveState(g),n.setTitle(g),n.Adapter.trigger(x,"statechange"),n.busy(!1);return !0},n.Adapter.bind(x,"popstate",n.onPopState),n.pushState=function(g,k,j,i){if(n.getHashByUrl(j)&&n.emulated.pushState){throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).")}if(i!==!1&&n.busy()){n.pushQueue({scope:n,callback:n.pushState,args:arguments,queue:i});return !1}n.busy(!0);var h=n.createStateObject(g,k,j);n.isLastSavedState(h)?n.busy(!1):(n.storeState(h),n.expectedStateId=h.id,m.pushState(h.id,h.title,h.url),n.Adapter.trigger(x,"popstate"));return !0},n.replaceState=function(g,k,j,i){if(n.getHashByUrl(j)&&n.emulated.pushState){throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).")}if(i!==!1&&n.busy()){n.pushQueue({scope:n,callback:n.replaceState,args:arguments,queue:i});return !1}n.busy(!0);var h=n.createStateObject(g,k,j);n.isLastSavedState(h)?n.busy(!1):(n.storeState(h),n.expectedStateId=h.id,m.replaceState(h.id,h.title,h.url),n.Adapter.trigger(x,"popstate"));return !0},n.bugs.safariPoll&&p(n.safariStatePoll,n.options.safariPollInterval);if(t.vendor==="Apple Computer, Inc."||(t.appCodeName||"")==="Mozilla"){n.Adapter.bind(x,"hashchange",function(){n.Adapter.trigger(x,"popstate")}),n.getHash()&&n.Adapter.onDomLoad(function(){n.Adapter.trigger(x,"hashchange")})}}},n.init()})(window);